{% extends "projects/base.html" %}
{% load l10n_tags %}
{% load project_tags %}
{% load activity_tags %}
{% load pagination_tags %}

{% block title %}{{ project.name }}{% endblock %}

{% block project_links %}
<link rel="alternate" type="application/atom+xml" href="{% locale_url activity_project_feed slug=project.slug %}" />
{% endblock %}

{% block bodyid %}project_landing{% endblock %}


{% block breadcrumbs_actions%}
  {% if is_challenge and organizing %}
    <a class="button" href="{% locale_url page_create slug=project.slug %}">{{ _('New Task') }}</a>
    <a class="button" href="{% locale_url projects_edit slug=project.slug %}">{{ _('Admin') }} {{ project.kind|title }}</a>
  {% endif %}
{% endblock %}


{% block body %}

{% sidebar %}

<div id="main">

  {% task_list project show_all_tasks %}

  {% if not is_challenge %}

  <div id="activity_header">
  <h2 class="school_header"><span>{{ _('Activity Wall') }}</span></h2>
  </div>
  {% if participating %}  
  <div id="create-post">
    <div class="post-container">
      <form action="{% locale_url statuses_create_project project_id=project.id %}" method="post" id="post-project-status-update">
	{% csrf_token %}
	<input id="fake-message-input" type="text" value="{{ _('Post a message') }}">
	<textarea name="status"></textarea>

        {% if organizing %}
            <div id="important-message" class="field{% if form.important.errors %} error{% endif %}">
                {{ form.important }} {{ _('Important message (participants can not turn off notifications for important messages).') }}
                {{ form.important.errors }}
            </div>
        {% endif %}
	
	<div class="status-and-actions">
	  <div class="post-char-count">750</div>
	  
	  <ul class="post-tags">
	    <li><span>{{ project.name|slice:":50" }}</span></li>
	  </ul>

          <a class="button update cancel" href="{{ project.get_absolute_url }}">
	    {{ _('Cancel') }}
	  </a>
          <button class="button update submit" id="post-project-update">{{ _('Post Update') }}</button>
	</div> <!-- /.status-and-actions -->
	</form>
      </div> <!-- /.post-container -->
    </div> <!-- /.#create-post -->
    {% endif %}

    {% activity_filters request project.get_absolute_url %}
    <ul id="posts">
      {% for activity in pagination_current_page.object_list %}
	  {% include "activity/_activity_resource.html" %}
      {% endfor %}
    </ul>
    {% with prefix='' page_url=project.get_absolute_url %}
      {% pagination_links %}
    {% endwith %}

  {% endif %}

</div> <!-- /#main -->

{% if is_challenge %}
  <div id="main-people">
    <section id="people" class="panel">
      <h2 class="school_header">{{ _('<strong>Need help?</strong> Peers that can help you with this challenge:') }}</h2>
      <br>
      {% for organizer in project.organizers %}
        <a href="{{ organizer.user.get_absolute_url }}" title="{{ organizer.user }} (organizer)"><img class="member-picture" src="{{ organizer.user.image_or_default }}" height="40" width="40" alt="{{ organizer.user }} (organizer)"></a>
      {% endfor %}

      {% if project.non_organizer_participants %}
        <hr class="break">
        <h2 class="school_header">{{ _('Peers taking this challenge:') }}</h2>
        <br>
        {% for participant in project.non_organizer_participants|slice:":42" %}
          <a href="{{ participant.user.get_absolute_url }}" title="{{ participant.user }} (participant)"><img class="member-picture" src="{{ participant.user.image_or_default }}" height="40" width="40" alt="{{ participant.user }} (participant)"></a>
        {% endfor %}
        {% if project.non_organizer_participants.count > 42 %}
          <p></p>
          <a id="more_people_link" href="{% locale_url projects_user_list slug=project.slug %}">{{_('View all')}} Â»</a>
        {% endif %}
      {% endif %}
    </section>
  </div>
{% endif %}

{% endblock %}

