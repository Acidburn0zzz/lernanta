{% extends "base.html" %}

{% load i18n %}
{% load l10n_tags %}
{% load project_tags %}

{% block title %}{{ _('Edit tasks') }}{% endblock %}
{% block css %}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/course.css?v=1">
{% endblock %}

{% block bodyid %}task_edit{% endblock %}

{% block links %}
  {% if project %}
    {% if project.accepted_school %}<link rel="stylesheet" href="{% locale_url schools_css slug=project.accepted_school.slug %}?v=1">{% endif %}
  {% endif %}
{% endblock %}

{% block js %}
<script type="text/javascript">
    var newTaskId = "";
    
    $(document).ready( function(){
        $("#id_task_add_button").bind('click', function(e){
            e.preventDefault();
            /// todo: check for unsubmitted data first
            if (newTaskId != '' && $("#" + newTaskId).size() > 0) {
                alert("please submit your changes first");
            } else {
                $.ajax({
                    url: $(this).attr('href'),
                    success: function(data, textStatus, jqXHR) {
                       $("#task_list").append(data);
                       newTaskId = $(data).attr('id');
                    }
                });
            }
        });

        $(".task_edit_action").bind('click', function(e){
            e.preventDefault();
            container = $(this).closest('div.task_edit_view');
            
            $.ajax({
                url: $(this).attr('href'),
                success: function(data, textStatus, jqXHR) {
                    container.empty();
                    container.append(data);
                }
            });
        });
        
        /*$(".task_edit_actions a").bind('click', function(e) {
            e.preventDefault();
            alert("catchall");
        });*/
    });
</script>
{% endblock %}

{% block breadcrumbs_title %}
  {% if project %}
    <h1 id="project-name">
      <a href="{{ project.get_absolute_url }}" class="school_header">{{ project.name }}</a>
    </h1>
  {% endif %}
{% endblock %}

{% block breadcrumbs %}
  <span class="arrow">&rsaquo;</span>
  <a href="{% learn_default %}">{{ _('Learn') }}</a>
  <span class="arrow">&rsaquo;</span>
  <a href="{{ project.get_absolute_url }}">{{ project.name }}</a>
{% endblock %}

{% block body %}
<section class="modal">
  <article>
    <h1>{{ _('Edit tasks') }}</h1>
    <div id="task_list">
        {% for task in tasks %}
            <div id="id_task_{{task.slug}}" class="task_edit_view">
                {{task.title}} --
                {{task.sub_header}}&nbsp;
                <div class="task_edit_actions">
                    <a class="task_edit_action" href="{% locale_url page_edit slug=project.slug page_slug=task.slug %}" >{{ _('Edit') }}</a>
                    <a href="{% locale_url page_delete slug=project.slug page_slug=task.slug %}">{{ _('Delete') }}</a>
                    {% if not forloop.first %}
                    <a href="{% locale_url page_index_up slug=project.slug page_slug=task.slug%}">{{ _('Up') }}</a>
                    {% endif %}
                    {% if not forloop.last %}
                    <a href="{% locale_url page_index_down slug=project.slug page_slug=task.slug%}">{{ _('Down') }}</a>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    <a id="id_task_add_button" class="button" href="{% locale_url page_create slug=project.slug %}">{{ _('Add Task') }}</a>
    
  </article>
</section>
{% endblock %}

