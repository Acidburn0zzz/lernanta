{% extends "base.html" %}
{% load l10n_tags %}
{% load i18n %}
{% load learn_tags %}

{% block title %}{{course.title}}{% endblock %}
{% block bodyclasses %}course-landing{% endblock%}

{% block css %}
<link rel="stylesheet" href="{{ STATIC_URL }}css/course.css?v=1">
{% endblock %}

{% block links %}
{% if project %}
  <meta name="thumbnail" property="og:image" content="{{ project.get_image_url }}" />
{% endif %}
{% endblock %}

{% block breadcrumbs_title %}
  <h1 id="project-name">{{course.title}}</h1>
{% endblock %}

{% block breadcrumbs %}
{% endblock %}

{% block body %}

<div class="row">
<div id="sidebar-wrapper" class="span3">
<div id="sidebar">
  <section id="project" class="panel">
    <figure class="project_img">
      <a id="id-course-image-link" href="{{ course.get_absolute_url }}">
        {% if course.image %}
  	         <img id="id-course-image" src="{{ MEDIA_URL }}{{ course.image }}" alt="course image"/>
        {% else %}
             <img id="id-course-image" src="{{ STATIC_URL}}images/project-missing.png" alt="course image"/>
        {% endif %}
        {% if course.draft %}
          <img id="id-course-image-overlay" src="{{ STATIC_URL }}images/course-draft.png" alt="draft course"/>
        {% endif %}
      </a>
    </figure>
    <div id="course-description">
        <p>{{ course.plug }}</p>
    </div>
    <div id="course-language">
        <p>{% language_name course.language %}</p>
    </div>
    <div>
      <p>
        {% trans "draft" %}
        <i class="icon-arrow-right"></i> 
        {% trans "published" %}
        <i class="icon-arrow-right"></i> 
        {% trans "archived" %}
      </p>
      {% if organizer and course.draft %}
        <p>Draft</p>
        <form action="{% locale_url courses_change_status course_id=course.id status='publish' %}" method="POST">
            {% csrf_token %}
            <p><button type="submit">{% trans "Publish" %}</button></p>
        </form>
      {% endif %}
      {% if organizer and not course.draft and not course.archived %}
        <p>Published</p>
          <form action="{% locale_url courses_change_status course_id=course.id status='archive' %}" method="POST">
            {% csrf_token %}
            <p><button type="submit">{% trans "Archive" %}</button></p>
        </form>
      {% endif %}
      {% if organizer and course.archived %}
        <p>Archived</p>
        <form action="{% locale_url courses_change_status course_id=course.id status='publish' %}" method="POST">
            {% csrf_token %}
            <p><button type="submit">{% trans "Resurrect" %}</button></p>
        </form>
      {% endif %}
    </div>
    <div>
      {% if cohort.signup == 'OPEN' %}
        <p>{% trans 'Singup is open. Anyone can sign up once the course is publised!' %}</p>
      {% endif %}
      {% if cohort.signup == 'MODERATED' %}
        <p>{% trans 'Singup is moderated. To sign up for this course you should contact one of the course organizer.' %}</p>
      {% endif %}
      {% if cohort.signup == 'CLOSED' %}
        <p>{% trans 'Singup is closed. Only organizer can add more people.' %}</p>
      {% endif %}

      {% if organizer and cohort.signup != 'OPEN' %}
        <form action="{% locale_url courses_change_signup course_id=course.id signup='open'%}" method="POST">
          {% csrf_token %}
          <p><button type="submit">{% trans 'Change to Open' %}</button></p>
        </form>
      {% endif %}
      {% if organizer and cohort.signup != 'MODERATED' %}
        <form action="{% locale_url courses_change_signup course_id=course.id signup='moderated'%}" method="POST">
          {% csrf_token %}
          <p><button type="submit">{% trans 'Change to Moderated' %}</button></p>
        </form>
      {% endif %}
      {% if organizer and cohort.signup != 'CLOSED' %}
        <form action="{% locale_url courses_change_signup course_id=course.id signup='closed'%}" method="POST">
          {% csrf_token %}
          <p><button type="submit">{% trans 'Change to Closed' %}</button></p>
        </form>
      {% endif %}
    </div>
    <div id="course-term">
      {% if cohort.term == 'ROLLING' %}
        <p>{%trans "This course doesn't have start and end dates"%}</p>
      {% else %}
        {% blocktrans with start_date=cohort.start_date end_date=cohort.end_date %}
          <p>This course runs from {{start_date}} to {{end_date}}</p>
        {% endblocktrans %}
      {% endif %}

      {% if organizer %}
        {%trans "Switch to fixed term and set dates"%}
        <form action="{% locale_url courses_change_term course_id=course.id term='fixed' %}" method="POST">
          {% csrf_token %}
          <p><label for="id_start_date">{% trans 'Start:' %}</label>{{term_form.start_date}}</p>
          <p><label for="id_end_date">{% trans 'End:' %}</label>{{term_form.end_date}}</p>
          <p><input type="submit" value="{% trans "Update fixed term" %}"/></p>
        </form>
        {% if cohort.term == 'FIXED' %}
          <form action="{% locale_url courses_change_term course_id=course.id term='rolling' %}">
            <p><input type="submit" value="{% trans "Switch to rolling term" %}"/></p>
          </form>
        {% endif %}
      {% endif %}
    </div>
    <div id="course-singup">
      {% if show_signup %}
        <form method="post" action="{% locale_url courses_signup course_id=course.id %}">
          {% csrf_token %}
          <button id="signup_button">{{ _('Start Course') }}</button>
        </form>
      {% endif %}
      {% if show_leave_course %}
        <form method="post" action="{% locale_url courses_leave course_id=course.id username=user.username %}">
          {% csrf_token %}
          <button id="leave_direct_signup_button">{{ _('Leave Course') }}</button>
        </form>
      {% endif %}
    </div>
    {% if tags %}
      <h3><b>{{ _('Tags') }}</b></h3>
      <ul class="tags">
        {% for tag in tags %}
          <li>
            <a href="{% learn_default tag %}" title="{{ _('View more tagged with ') }}{{ tag.name }}">
              {{ tag.name }}
            </a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

  </section>

</div> <!-- /#sidebar -->
</div>


<div id="main" class="span9">

  <div class="tabbable">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#about-tab" data-toggle="tab">{% trans 'About' %}</a></li>
      <li><a href="#content-tab" data-toggle="tab">{% trans 'Content' %}</a></li>
      <li><a href="#discussion-tab" data-toggle="tab">{% trans 'Discussion' %}</a></li>
      <li><a href="#badges-tab" data-toggle="tab">{% trans 'Badges' %}</a></li>
      <li><a href="#people-tab" data-toggle="tab">{% trans 'People' %}</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="about-tab">
        {% if about.content|length == 0 %}
          <p>{% blocktrans %}There is no description what this course is about. You can add a description by editing this page.</a>{% endblocktrans %}
          </p>
        {% else %}
          <div class="markup">{{ about.content|safe }}</div>
        {% endif %}
        <p>
        <a href="{% locale_url courses_edit_content course_id=course.id content_id=about.id %}">
            <i class="icon-edit">edit</i>
        </a>
        </p>
      </div>
  
      <div class="tab-pane" id="content-tab">
        {% if course.content|length %}
          <ul>
            {% for task in course.content %}
              <li class="{% cycle 'odd' 'even' %}">
                <a class="taskLink" href="{% locale_url courses_content_show course_id=course.id, content_id=task.id %}">{{ task.title }}</a>
                {% if organizer %}
                    {% if not forloop.first %}<a class="robttn up" href="{% locale_url courses_content_up course_id=course.id content_id=task.id %}">(UP)</a>{% endif %}
                    {% if not forloop.last %}<a class="robttn dwn" href="{% locale_url courses_content_down course_id=course.id content_id=task.id%}">(DOWN)</a>{% endif %}
                {% endif %}
                <a class="taskView" href="#">{{ _('View and Discuss') }}</a>
                <a href="{% locale_url courses_edit_content course_id=course.id content_id=task.id %}">
                    <i class="icon-edit">edit</i>
                </a>
  
              </li>
            {% endfor %}
            {% if organizer %}
              <a href="{% locale_url courses_create_content course_id=course.id %}">
                <i class="icon-plus">add</i>
              </a>
            {% endif %}
          </ul>
        {% else %}
          {% if organizer %}
            <p>{% blocktrans %}No content have been added. {% endblocktrans %}<a href="{% locale_url courses_create_content course_id=course.id%}">Click here</a> to add some content</p>
          {% endif %}
        {% endif %}
      </div>
  
      <div class="tab-pane" id="discussion-tab">
        {% for comment in comments %}
          <div class="post-container">
            <a name="comment-{{comment.id}}"></a>
            {{comment.content}}
            {% if comment.replies|length > 0 %}
              <p>
                {% blocktrans with reply_count=comment.replies|length %}{{reply_count}} replies{% endblocktrans %}
              </p>
            {% endif %}
            <a href="#"><i class="icon-comment">comment</i></a>
            <form action="{% locale_url courses_post_comment_reply course_id=course.id content_id=about.id comment_id=comment.id %}" method="POST">
              {% csrf_token %}
              <textarea id="id_comment" name="comment" cols="40" rows="2"></textarea>
              <input type="submit" value="{% trans "Post comment" %}"/>
            </form>
          </div>
        {% endfor %}
  
        <div>
          <a href="#"><i class="icon-comment">comment</i></a>
          <form action="{% locale_url courses_post_content_comment course_id=course.id content_id=about.id %}" method="POST">
            {% csrf_token %}
            <textarea id="id_comment" name="comment" cols="40" rows="2"></textarea>
            <input type="submit" value="{% trans "Post comment" %}"/>
          </form>
        </div>
      </div>
  
      <div class="tab-pane" id="badges-tab">
        {% if submission_enabled_badges %}
          <div class="bottom-sidebar">
            {% for badge in submission_enabled_badges %}
              {% if not forloop.first %}<hr class="badge-break">{% endif %}
              <div class="badge">
                {% with awards_count=badge.awards.count pending_count=badge.get_pending_submissions.count %}
                  <div class="badge-top">
                    <a href="{{ badge.get_absolute_url }}" title="{{ badge|title }}"><img class="badge-graphic" src="{{ badge.get_image_url }}" width="80" height="80" alt="{{ badge|title }}"/></a>
                    <div class="badge-awarded">
                      <a class="badge-awarded-header" href="{% locale_url awarded_matching_submissions slug=badge.slug %}">{{ _('Awarded') }}</a>
                      <a class="badge-awarded-number" href="{% locale_url awarded_matching_submissions slug=badge.slug %}">{{ awards_count }}</a>
                    </div>
                    <div class="badge-pending">
                      <a class="badge-pending-header" href="{% locale_url matching_submissions slug=badge.slug %}">{{ _('Pending') }}</a>
                      <a class="badge-pending-number" href="{% locale_url matching_submissions slug=badge.slug %}">{{ pending_count }}</a>
                    </div>
                  </div>
                  <div class="badge-bottom">
                    {% if pending_count %}
                      <a href="{% locale_url matching_submissions slug=badge.slug %}">
                        {% blocktrans count counter=pending_count %}{{ counter }} peer needs your review!{% plural %}{{ counter }} peers need your review!{% endblocktrans %} {{ _('Go') }} →
                      </a>
                    {% endif %}
                  </div>
                {% endwith %}
              </div>
            {% endfor %}
          </div>
        {% endif %}
  
  
      </div>
 
      <div class="tab-pane" id="people-tab">
        <ul>
          {% for user in cohort.users %}
            <li class="user-tile">
              <a href="#"><img src="{{ STATIC_URL }}/images/member-missing.png" alt="{{user.username}}"></a>
              {% if organizer %}
                <a href="{% locale_url courses_leave course_id=course.id username=user.username %}">{% trans "Remove user" %}</a>
                {% if user.role == "LEARNER" %}
                  <form action="{% locale_url courses_add_organizer course_id=course.id username=user.username %}" method="POST">
                    {% csrf_token %}
                    <button type="submit">{% trans "Make organizer" %}</button>
                  </form>
                {% endif %}
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>

    </div>
  </div> <!-- /#tabbable -->
</div> <!-- /#main -->

</div> <!-- /#row -->

{% endblock %}

{% block js %}
  <script>
    $(document).ready(function(){
      $("#id_start_date").datepicker();
    });
  </script>
{% endblock %}
