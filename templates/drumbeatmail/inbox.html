{% extends "base.html" %}
{% load l10n_tags %}

{% block title %}{{ _('Inbox') }}{% endblock %}
{% block pageid %}inbox{% endblock %}
{% block breadcrumbs %}
<div class="container">
  <nav>
    <a href="{% locale_url drumbeatmail_inbox %}">{{ _('Inbox') }}</a>
  </nav>
  <div id="project-actions"> <!-- TODO: reusing div#id -->
    <div id="create-message" class="button">
      <a class="submit-button" href="{% locale_url drumbeatmail_compose %}">{{ _('New Private Discussion') }}</a>
    </div>
  </div>
</div>
{% endblock %}

{% block body %}
<div id="sidebar">
  <div class="panel">
    <h2>{{ _('Inbox') }}</h2>
  </div>

  <div class="panel">
    <ul>
      <li><a href="{% locale_url drumbeatmail_inbox %}">{{ _('All Messages') }}{% if messages_inbox_count > 0 %} ({{ messages_inbox_count }}){% endif %}</a></li>
    </ul>

    <ul>
      <li><a href="{% locale_url drumbeatmail_outbox %}">{{ _('Sent') }}</a></li>
    </ul>

    {% if senders %}
      <ul>
	{% for sender, count in senders %}
	  <li><a href="{% locale_url drumbeatmail_inbox_filtered filter=sender.username %}">{{ sender.name }} ({{ count }})</a></li>
	{% endfor %}
      </ul>
    {% endif %}
  </div>
</div>

<div id="main">
  {% if not inbox %}
    <p>{{ _('You have no messages') }}</p>
  {% else %}

  <ul id="posts">
    {% for message in inbox %}
    <li class="post-container">
      <a name="message{{ message.id }}" />

      {% if message.sender != user %}
      <a href="{% locale_url drumbeatmail_reply message=message.id %}" class="reply-to">{{ _('Reply') }}</a>
      {% endif %}
      
      {% if message.sender == user %}
	<a href="{{ message.recipient.get_profile.get_absolute_url }}">
	  <img class="member-picture" width="54" height="54" src="{{ MEDIA_URL }}{{ message.recipient.get_profile.image_or_default }}">
	</a>
      {% else %}
	<a href="{{ message.sender.get_profile.get_absolute_url }}">
	  <img class="member-picture" width="54" height="54" src="{{ MEDIA_URL }}{{ message.sender.get_profile.image_or_default }}">
	</a>
      {% endif %}

      <div class="post-contents">
	<div class="post-details">
	  {% if message.sender == user %}
	    <a class="member-name" href="{{ message.recipient.get_profile.get_absolute_url }}">{{ message.recipient.get_profile.name }}</a>
	  {% else %}
	    <a class="member-name" href="{{ message.sender.get_profile.get_absolute_url }}">{{ message.sender.get_profile.name }}</a>
	  {% endif %}
	  {{ message.sent_at }}
	</div>

	<div class="post-body">
	  {% if message.subject %}
	  <h2>{{ message.subject }}</h2>
	  <br />
	  {% endif %}
	  {{ message.body }}
	</div>

	<div class="clear ir"></div>

      </div>

    </li>
    {% endfor %}
  </ul>

  {% endif %}
</div>

{% endblock %}
